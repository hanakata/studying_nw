第5章 デバイスの信頼と信用

信頼と信用を獲得する
一般に新しく導入されるデバイスにはその製造元や販売業者と同じレベルの信頼が与えられる。
信頼度はかなり高い。ただしこの信頼度は物理的なもの。
論理的なゼロトラストモデルに反映させるにはデバイスに物理的に注入し検証可能な信用できる状態にする必要がある。

アイデンティティの生成と保護
デバイスの識別に使用できる署名された証明書を提供する際にはその証明書に関連づけられている秘密鍵を安全な方法で保管する必要がある。
秘密鍵が入手できればデバイスを偽造できる。
これを防ぐ単純な方法はアクセス制御を設定すること。
→ただし安全ではない。管理者権限が取れれば何でもできてしまう。
秘密鍵を暗号化する
→アクセス許可よりまし。ただ複合するのにパスワードが必要なので使い勝手に問題がある。
保管するにはTPMと呼ばれるセキュアな領域が良い。

静的なシステムと動的なシステムでのアイデンティティのセキュリティ
静的なシステムでは新しいホストのプロビジョニングは運用者によって行われる。
インフラが拡大していけば人的負担が問題になる。
プロビジョニングと署名プロセスの自動化では新しい証明書の署名に人間が関与すべきかが重要な判断。
プロビジョニングが自動化されていても人間が管理しているという場合、
関連する署名リクエストの承認もその人物に管理させるのは当然。
ただし人間は完璧ではない。なのでワンタイムパスワードを利用する。
証明書の署名は大きな信頼を必要とする操作。
信頼を手に入れる選択肢は以下3つ。
・人間
・リソースマネージャー
・イメージまたはデバイス
静的なインフラであれば人間は手軽で安全。
自動化されたインフラであれば人間は役に立たない。

コントロールプレーンによるデバイスの認証
アイデンティティをネットワーク上で検証する方法を考える必要がある
・X.509
デバイスのアイデンティティと認証に関する規格の中で最も重要な規格。
最も優れた特徴の1つは認証に使用される公開鍵と秘密鍵のペアを暗号化された通信の確立にも使用できること。
・証明書チェーンと認証局
証明書が意味を持つ＝信用されなければならない
正しい名前が書かれた証明書ではなく、信頼される機関によるデジタル署名により
証明書の正当性を保証しなければならない。
・デバイスのアイデンティティとx.509
X.509証明書の主な用途は認証。
・公開鍵と秘密鍵
X.509証明書は2つの鍵を利用する。基本はRSA.
・秘密鍵の保管
秘密鍵の保管は非常に重要。漏洩すればまったく意味がなくなる。
保護する場合はHSMを利用すると良い。
・デバイス認証のためのX.509
ゼロトラストネットワークでX.509を応用するのはすばらしいこと。
考慮しなければならないのは秘密鍵はソフトウェア的なものであること。
なので盗み出されれば破綻する。
TPMを利用すれば秘密鍵とハードウェアを一体化させることができる。

TPM
TPM=コンピュートデバイスに埋め込まれる特殊なチップ。
暗号プロセッサとも呼ばれ信頼できる安全な方法で暗号処理を行うことを目的としている。
独自のファームウェアで動作するのでワンチップコンピュータと考えられている。

TPMを使ったデータの暗号化
TPMはSRKと呼ばれるものを生成し格納する。この鍵ペアはTPMデバイスの信頼ルートを表す。
暗号化されたものを復号できるのはおおもとのTPM内のSRKだけ。
大容量時は考慮が必要。

中間鍵とパスフレーズ
多くのTPMライブラリはTPMを使ってデータを暗号化するときに中間鍵を生成する。
そのライブラリはTPMに新しい非対称鍵ペアの作成を要求する。
そして中間鍵ペアの公開鍵を使ってAES鍵を暗号化した後、SRK使って秘密鍵を暗号化する。
復号化するときは中間鍵ペアの秘密鍵を復号し復号した秘密鍵を使ってAES鍵を復号化してから元のデータを復号化する。
こうなっている理由
・追加の暗号により保護されたデータを柔軟に配布できるようになること

PCR
PCR=TPMの重要な機能であり実行中のソフトウェアハッシュ値が格納されるストレージスロットを提供する
PCRの用途は様々だが承認されたソフトウェア設定でのみデータの復号を許可することが含まれる。

リモートアテステーション
秘密鍵が物理的にTPMの外側に保存される限り盗み出される可能性はある。
TPMにロックを一度解除させるだけで秘密鍵を復号化できる。
TPMの中に格納されていればこれらは不可能。

デバイス認証のためのTPM
成熟したゼロトラストネットワークにおいて強力なデバイス認証に対する最善の選択はTPMである。
制限として、仮想マシンやコンテナで使うためにはTPMによる仮想化を利用するようにしなければならない。
サポートが進んでいないことも制限の一つ

ハードウェアベースのゼロトラストサプリカント
ゼロトラストネットワークにおいて既存のデバイスをサポートする最も一般的な方法は認証プロキシを使用すること。
認証プロキシはゼロトラスト関係を終端し接続をレガシーホストに転送する。

インベントリ管理
デバイスのアイデンティティと完全性チェックは強力なゼロトラストセキュリティを提供する上で大きな役割を果たす。
反面デバイスを組織に属しているものとすることは課題の一部。
インベントリ管理ではデバイスとそれらのプロパティを分類する必要がある。