第8章 トラフィックの信頼と信用

暗号化と認証
暗号化と認証は隣り合わせの関係にあるが、目的はまったく違う。
暗号化＝機密性を確保
認証＝送信者を受信者が検証可能＋完全性
→とにかく認証すべき

暗号化なしで真正性は確保できるか
暗号化は結構厄介。トラフィック調査するにしても復号化が必須。
機密性がないのも問題なので暗号化は必要。

信頼の確立：最初のパケット
フローの最初のパケットは厄介で接続の種類やデバイスのライフライムのタイミング次第で
ほとんど信頼できない可能性がある。
mTLSなどのプロトコルを使えばデバイスを認証してからサービスにアクセスさせることができる。
ファーストパケット問題には事前認証と呼ばれる手法で解決が可能
使う場合はUDP.事前認証オペレーションはSPAと呼ばれる。

fwknop
オープンソースSPA実装。特徴は以下
・一時的な例外
fwknopが有効なSPAパケットを受信すると復号され検証される。
ペイロードにはプロトコルとポート番号が含まれる。
それをもとにファイアウォールを定義することができる。
・SPAペイロード
ペイロードは以下
　16バイトのランダムデータ
　ローカルユーザ名
　ローカルタイムスタンプ
　fwknopのバージョン
　SPAメッセージタイプ
　アクセスリクエスト
　SPAメッセージダイジェスト
・暗号化
暗号化関してはAESとGPGの2種類がサポートされている。
少人数であればAES。大人数になるとGPG
・HMAC
ペイロードの最後につける真正性を保証するデータ。

ネットワークモデルの概要
ネットワークスタックはデータ送信において様々な責任を負っている。
そおためネットワークスタックのコードは煩雑になりがち。
→標準化し明確に定義することを決定。

ネットワークの各層
ネットワークはレイヤという考え方。OSIネットワークモデルが主流

OSIネットワークモデル
OSI参照モデルは7つのレイヤで定義されている。
レイヤ1:物理層
物理媒体間のインターフェイスとして定義
レイヤ2:データリンク層
物理層上のデータ通信を管理する。
レイヤ3:ネットワーク層
データパケットの送受信管理
レイヤ4:トランスポート層
・ステート降る接続
・多重化
・配信の順序付け
・フロー制御
・再送信
これらのサービスを提供
レイヤ5:セッション層
接続の状態に関するレイヤ。
レイヤ6:プレゼンテーション層
アプリケーションデータと伝送可能なデータストリーム間の変換を受け持つ。
レイヤ7:アプリケーション層
アプリケーションがネットワーク上での通信に使用する高度な通信プロトコルを提供

TCP/IPネットワークモデル
OSI参照モデルとは違い厳密な層を定義するわけではないが以下の層が定義されている。
・リンク層
・インターネット層
・トランスポート層
・アプリケーション層
